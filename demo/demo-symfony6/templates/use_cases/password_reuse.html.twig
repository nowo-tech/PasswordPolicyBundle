{% extends 'use_cases/base.html.twig' %}

{% block title %}Password Reuse Prevention - Use Cases{% endblock %}

{% block use_case_title %}Password Reuse Prevention{% endblock %}

{% block use_case_content %}
    
    <div class="info-box info-box-info">
        <h3>How Password Reuse Prevention Works</h3>
        <p>The bundle prevents users from reusing passwords that are in their password history. This is enforced by the <code>@PasswordPolicy</code> validator constraint.</p>
    </div>
    
    <h2>Test Cases</h2>
    <p>The following users have password history that can be used to test reuse prevention:</p>
    
    {% if testCases|length > 0 %}
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>History Count</th>
                    <th>Oldest Password Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for testCase in testCases %}
                    <tr>
                        <td>{{ testCase.user.email }}</td>
                        <td>{{ testCase.historyCount }}</td>
                        <td>
                            {% if testCase.oldestPassword %}
                                {{ testCase.oldestPassword.createdAt|date('Y-m-d H:i:s') }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ path('user_change_password', {'id': testCase.user.id}) }}" class="btn">Change Password</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p><em>No users with password history found.</em></p>
    {% endif %}
    
    <h2>How to Test</h2>
    <ol>
        <li>Go to a user's "Change Password" page</li>
        <li>Try to set a password that matches one in the user's history</li>
        <li>The <code>@PasswordPolicy</code> validator will reject it with an error</li>
        <li>You must use a password that is not in the history</li>
    </ol>
    
    <div class="info-box info-box-success">
        <strong>âœ… Validation Flow:</strong>
        <ol style="margin: 10px 0 0 20px;">
            <li>User submits new password via form</li>
            <li>Symfony Validator processes the <code>@PasswordPolicy</code> constraint</li>
            <li><code>PasswordPolicyValidator</code> checks password against history</li>
            <li>If password matches history, validation fails</li>
            <li>Form shows validation error to user</li>
        </ol>
    </div>
{% endblock %}

